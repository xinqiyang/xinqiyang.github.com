<!-- build time:Tue Feb 06 2018 18:01:02 GMT+0800 (CST) --><!DOCTYPE html><html class="theme-next muse use-motion" lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=6.0.3" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.3"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.3"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.3"><link rel="mask-icon" href="/images/logo.svg?v=6.0.3" color="#222"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"6.0.3",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="keywords" content="block chain, binance, historical data,"><meta name="description" content="最近币圈大跌，作为一棵吊在高处的韭菜，还是觉得好好的做开发比跟风靠谱多了，遂静下心来，好好的写点文章，做点数据分析，抓取进阶下。接触区块链其实在三年前，一个朋友就提醒我们多关注区块链，那个时候的我们还是少不更事的认为那个虚的东西又撒好玩的，到现在回首看，眼界比技能和运气要重要得多。做人没有好的眼光，上不去的，还是捡起来好好的分析下区块链技术，后续会多些一些。言归正传，最近在分析各个交易所的数据，对"><meta name="keywords" content="block chain, binance, historical data"><meta property="og:type" content="article"><meta property="og:title" content="区块链数据分析之保存币安历史数据"><meta property="og:url" content="http://yangxinqi.com/2018/02/06/区块链数据分析之保存币安历史数据/index.html"><meta property="og:site_name" content="xinqiyang notes"><meta property="og:description" content="最近币圈大跌，作为一棵吊在高处的韭菜，还是觉得好好的做开发比跟风靠谱多了，遂静下心来，好好的写点文章，做点数据分析，抓取进阶下。接触区块链其实在三年前，一个朋友就提醒我们多关注区块链，那个时候的我们还是少不更事的认为那个虚的东西又撒好玩的，到现在回首看，眼界比技能和运气要重要得多。做人没有好的眼光，上不去的，还是捡起来好好的分析下区块链技术，后续会多些一些。言归正传，最近在分析各个交易所的数据，对"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2018-02-06T06:10:47.221Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="区块链数据分析之保存币安历史数据"><meta name="twitter:description" content="最近币圈大跌，作为一棵吊在高处的韭菜，还是觉得好好的做开发比跟风靠谱多了，遂静下心来，好好的写点文章，做点数据分析，抓取进阶下。接触区块链其实在三年前，一个朋友就提醒我们多关注区块链，那个时候的我们还是少不更事的认为那个虚的东西又撒好玩的，到现在回首看，眼界比技能和运气要重要得多。做人没有好的眼光，上不去的，还是捡起来好好的分析下区块链技术，后续会多些一些。言归正传，最近在分析各个交易所的数据，对"><link rel="alternate" href="/atom.xml" title="xinqiyang notes" type="application/atom+xml"><link rel="canonical" href="http://yangxinqi.com/2018/02/06/区块链数据分析之保存币安历史数据/"><script type="text/javascript" id="page.configurations">CONFIG.page={sidebar:""}</script><title>区块链数据分析之保存币安历史数据 | xinqiyang notes</title><noscript><style type="text/css">.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="en-US"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">xinqiyang notes</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Nothing behind me, everything ahead of me,as is ever so on the road.</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-blockchain"><a href="/categories/blockchain" rel="section"><i class="menu-item-icon fa fa-fw fa-bitcoin"></i><br>blockchain</a></li><li class="menu-item menu-item-ai"><a href="/categories/ai" rel="section"><i class="menu-item-icon fa fa-fw fa-star"></i><br>ai</a></li><li class="menu-item menu-item-devops"><a href="/categories/devops" rel="section"><i class="menu-item-icon fa fa-fw fa-code"></i><br>devops</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a></li><li class="menu-item menu-item-other"><a href="/categories/other" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>other</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://yangxinqi.com/2018/02/06/区块链数据分析之保存币安历史数据/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="xinqiyang"><meta itemprop="description" content=""><meta itemprop="image" content="/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="xinqiyang notes"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">区块链数据分析之保存币安历史数据</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-06T09:29:25+08:00">2018-02-06</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blockchain/" itemprop="url" rel="index"><span itemprop="name">blockchain</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>最近币圈大跌，作为一棵吊在高处的韭菜，还是觉得好好的做开发比跟风靠谱多了，遂静下心来，好好的写点文章，做点数据分析，抓取进阶下。</p><p>接触区块链其实在三年前，一个朋友就提醒我们多关注区块链，那个时候的我们还是少不更事的认为那个虚的东西又撒好玩的，到现在回首看，眼界比技能和运气要重要得多。做人没有好的眼光，上不去的，还是捡起来好好的分析下区块链技术，后续会多些一些。</p><p>言归正传，最近在分析各个交易所的数据，对接了几个交易所（bitflyer， coincheck， binance，btcbox）后续在对接一些其他的。首先作为技术出身，还是好好的做数据分析吧，先爬一些数据下来，就到处找相关的接口文档，然后通过python来把数据抓下来。这块就需要大家提供的访问api，有很多人写了交易所第三方的访问api，发布在github上，我们就使用这些api来访问以获取数据。</p><p>看了好几篇文章，第一篇先给澳大利亚的一个大叔级高手打广告，翻译下他的文章，这个哥们写了好几个交易所的获取客户端。</p><p>原文链接： <a href="https://sammchardy.github.io/binance/2018/01/08/historical-data-download-binance.html" target="_blank" rel="noopener">https://sammchardy.github.io/binance/2018/01/08/historical-data-download-binance.html</a></p><a id="more"></a><h3 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h3><p>任何交易策略的基础都是有一个好的回测方案，如果你没有数据，就没法回测，数据还是很重要的。</p><p>在这篇文章中，我将详细描述通过Binance API在指定时间范围内下载和保存币安的历史K线数据。</p><p>这个例子不需要有币安的账户，直接访问公开的API即可。</p><h3 id="首先需要处理时间格式"><a href="#首先需要处理时间格式" class="headerlink" title="首先需要处理时间格式"></a>首先需要处理时间格式</h3><p>因为币安服务器只接受毫秒级别的时间戳的时间段，所以需要将工作日时间转换为毫秒时间戳。</p><p>本次使用强大的python来进行处理，安装dateparser包。命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install dateparser</span><br></pre></td></tr></table></figure><p>我们可以得写个函数将日期字符串直接转换成毫秒格式。例子如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(date_to_milliseconds(<span class="string">"January 01, 2018"</span>))</span><br><span class="line">print(date_to_milliseconds(<span class="string">"11 hours ago UTC"</span>))</span><br><span class="line">print(date_to_milliseconds(<span class="string">"now UTC"</span>))</span><br></pre></td></tr></table></figure><h3 id="获取币安的K线数据"><a href="#获取币安的K线数据" class="headerlink" title="获取币安的K线数据"></a>获取币安的K线数据</h3><p>现在我们希望通过 get_klines API来获取实际的交易量数据。</p><p>先看下接口参数：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">symbol - e.g ETHBTC  币种数据</span><br><span class="line">interval - one of (1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 8h, 12h, 1d, 3d, 1w, 1M) 时间范围</span><br><span class="line">limit - max 500  限制条数</span><br><span class="line">startTime - milliseconds  开始时间 单位毫秒</span><br><span class="line">endTime - milliseconds    结束时间 单位毫秒</span><br></pre></td></tr></table></figure><p>因为一次最多取500条，如果时间范围比较大，我们得循环获取。</p><p>返回结果格式：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    <span class="number">1499040000000</span>,      <span class="comment"># Open time </span></span><br><span class="line">    <span class="string">"0.01634790"</span>,       <span class="comment"># Open</span></span><br><span class="line">    <span class="string">"0.80000000"</span>,       <span class="comment"># High</span></span><br><span class="line">    <span class="string">"0.01575800"</span>,       <span class="comment"># Low</span></span><br><span class="line">    <span class="string">"0.01577100"</span>,       <span class="comment"># Close</span></span><br><span class="line">    <span class="string">"148976.11427815"</span>,  <span class="comment"># Volume</span></span><br><span class="line">    <span class="number">1499644799999</span>,      <span class="comment"># Close time</span></span><br><span class="line">    <span class="string">"2434.19055334"</span>,    <span class="comment"># Quote asset volume</span></span><br><span class="line">    <span class="number">308</span>,                <span class="comment"># Number of trades</span></span><br><span class="line">    <span class="string">"1756.87402397"</span>,    <span class="comment"># Taker buy base asset volume</span></span><br><span class="line">    <span class="string">"28.46694368"</span>,      <span class="comment"># Taker buy quote asset volume</span></span><br><span class="line">    <span class="string">"17928899.62484339"</span> <span class="comment"># Ignore</span></span><br><span class="line">  ]</span><br></pre></td></tr></table></figure><p>我们把返回的结果都存储起来，有多少存多少。</p><h3 id="币安时间间隔intervals"><a href="#币安时间间隔intervals" class="headerlink" title="币安时间间隔intervals"></a>币安时间间隔intervals</h3><p>参数中的intervals是一个字符串，一次请求只能是在某个范围内，一次限制是500，所以需要获取较长时间段数据的话，需要对时间间隔进行毫秒转换。将API中设定的时间，转换成毫秒， 例子如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> binance.client <span class="keyword">import</span> Client</span><br><span class="line"></span><br><span class="line">print(interval_to_milliseconds(Client.KLINE_INTERVAL_1MINUTE))</span><br><span class="line">print(interval_to_milliseconds(Client.KLINE_INTERVAL_30MINUTE))</span><br><span class="line">print(interval_to_milliseconds(KLINE_INTERVAL_1WEEK))</span><br></pre></td></tr></table></figure><h3 id="获取K线数据"><a href="#获取K线数据" class="headerlink" title="获取K线数据"></a>获取K线数据</h3><p>准备好了之后，我们开始写方法来获取历史数据。 我们通过时间范围和intervals间隔参数很容易的获取。例子如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> binance.client <span class="keyword">import</span> Client</span><br><span class="line"></span><br><span class="line"><span class="comment"># fetch 1 minute klines for the last day up until now</span></span><br><span class="line">klines = get_historical_klines(<span class="string">"BNBBTC"</span>, Client.KLINE_INTERVAL_1MINUTE, <span class="string">"1 day ago UTC"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fetch 30 minute klines for the last month of 2017</span></span><br><span class="line">klines = get_historical_klines(<span class="string">"ETHBTC"</span>, Client.KLINE_INTERVAL_30MINUTE, <span class="string">"1 Dec, 2017"</span>, <span class="string">"1 Jan, 2018"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fetch weekly klines since it listed</span></span><br><span class="line">klines = get_historical_klines(<span class="string">"NEOBTC"</span>, KLINE_INTERVAL_1WEEK, <span class="string">"1 Jan, 2017"</span>)</span><br></pre></td></tr></table></figure><p>完整的代码可以从<a href="https://github.com/sammchardy/python-binance" target="_blank" rel="noopener">python-binance</a>项目的例子中获取，链接： <a href="https://github.com/sammchardy/python-binance/tree/master/examples" target="_blank" rel="noopener">examples folder</a></p><h3 id="保存到文件"><a href="#保存到文件" class="headerlink" title="保存到文件"></a>保存到文件</h3><p>获取到的数据后存到文件以方便后面使用。代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> binance.client <span class="keyword">import</span> Client</span><br><span class="line"></span><br><span class="line">symbol = <span class="string">"ETHBTC"</span></span><br><span class="line">start = <span class="string">"1 Dec, 2017"</span></span><br><span class="line">end = <span class="string">"1 Jan, 2018"</span></span><br><span class="line">interval = Client.KLINE_INTERVAL_30MINUTE</span><br><span class="line"></span><br><span class="line">klines = get_historical_klines(symbol, interval, start, end)</span><br><span class="line"></span><br><span class="line"><span class="comment"># open a file with filename including symbol, interval and start and end converted to milliseconds</span></span><br><span class="line"><span class="keyword">with</span> open(</span><br><span class="line">    <span class="string">"Binance_&#123;&#125;_&#123;&#125;_&#123;&#125;-&#123;&#125;.json"</span>.format(</span><br><span class="line">        symbol, </span><br><span class="line">        interval, </span><br><span class="line">        date_to_milliseconds(start),</span><br><span class="line">        date_to_milliseconds(end)</span><br><span class="line">    ),</span><br><span class="line">    <span class="string">'w'</span> <span class="comment"># set file write mode</span></span><br><span class="line">) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(json.dumps(klines))</span><br></pre></td></tr></table></figure><h3 id="打赏功能"><a href="#打赏功能" class="headerlink" title="打赏功能"></a>打赏功能</h3><p>这些好的方法，已经添加到<a href="https://github.com/sammchardy/python-binance" target="_blank" rel="noopener">python-binance</a>方便大家使用。</p><p><code>date_to_milliseconds</code> 和 <code>interval_to_milliseconds</code>已经添加到binance.helpers中。<code>get_historical_klines</code>已经添加到finance.client中，直接调用即可。代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> binance.client <span class="keyword">import</span> Client</span><br><span class="line"></span><br><span class="line">client = Client(<span class="string">""</span>, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">klines = client.get_historical_klines(<span class="string">"ETHBTC"</span>, Client.KLINE_INTERVAL_30MINUTE, <span class="string">"1 Dec, 2017"</span>, <span class="string">"1 Jan, 2018"</span>)</span><br></pre></td></tr></table></figure><h3 id="接下来"><a href="#接下来" class="headerlink" title="接下来"></a>接下来</h3><p>使用这些获取的数据，我们可以在后续的回测中使用。</p><p>使用Kucoin交易所的用户同样使用<a href="https://github.com/sammchardy/python-kucoin" target="_blank" rel="noopener">python-kucoin</a> 也有这些功能。</p><p>后续还会写一些使用 <a href="https://pandas.pydata.org/" target="_blank" rel="noopener">pandas</a> 和 <a href="https://github.com/mrjbq7/ta-lib" target="_blank" rel="noopener">TA-Lib</a> 来进行简单的回测的文章。</p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p><a href="https://twitter.com/sammchardy" target="_blank" rel="noopener">sammchardy</a> 是一个很帅的澳洲哥们，大家可以在twitter上关注他， 作为开源的api客户端，写的也非常的便捷，对于这样有分享的精神的哥们，大家是不是给点打赏呢，他也给了Donate地址了。大家可以查看原文。</p><p>我在最后也贴下全文例子的链接：</p><p><a href="https://github.com/sammchardy/python-binance/blob/master/examples/save_historical_data.py" target="_blank" rel="noopener">save_historical_data.py</a> 大家可以下下来实际的跑一下试试。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> dateparser</span><br><span class="line"><span class="keyword">import</span> pytz</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> binance.client <span class="keyword">import</span> Client</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">date_to_milliseconds</span><span class="params">(date_str)</span>:</span></span><br><span class="line">    <span class="string">"""Convert UTC date to milliseconds</span></span><br><span class="line"><span class="string">    If using offset strings add "UTC" to date string e.g. "now UTC", "11 hours ago UTC"</span></span><br><span class="line"><span class="string">    See dateparse docs for formats http://dateparser.readthedocs.io/en/latest/</span></span><br><span class="line"><span class="string">    :param date_str: date in readable format, i.e. "January 01, 2018", "11 hours ago UTC", "now UTC"</span></span><br><span class="line"><span class="string">    :type date_str: str</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># get epoch value in UTC</span></span><br><span class="line">    epoch = datetime.utcfromtimestamp(<span class="number">0</span>).replace(tzinfo=pytz.utc)</span><br><span class="line">    <span class="comment"># parse our date string</span></span><br><span class="line">    d = dateparser.parse(date_str)</span><br><span class="line">    <span class="comment"># if the date is not timezone aware apply UTC timezone</span></span><br><span class="line">    <span class="keyword">if</span> d.tzinfo <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> d.tzinfo.utcoffset(d) <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        d = d.replace(tzinfo=pytz.utc)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># return the difference in time</span></span><br><span class="line">    <span class="keyword">return</span> int((d - epoch).total_seconds() * <span class="number">1000.0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">interval_to_milliseconds</span><span class="params">(interval)</span>:</span></span><br><span class="line">    <span class="string">"""Convert a Binance interval string to milliseconds</span></span><br><span class="line"><span class="string">    :param interval: Binance interval string 1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 8h, 12h, 1d, 3d, 1w</span></span><br><span class="line"><span class="string">    :type interval: str</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">         None if unit not one of m, h, d or w</span></span><br><span class="line"><span class="string">         None if string not in correct format</span></span><br><span class="line"><span class="string">         int value of interval in milliseconds</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    ms = <span class="keyword">None</span></span><br><span class="line">    seconds_per_unit = &#123;</span><br><span class="line">        <span class="string">"m"</span>: <span class="number">60</span>,</span><br><span class="line">        <span class="string">"h"</span>: <span class="number">60</span> * <span class="number">60</span>,</span><br><span class="line">        <span class="string">"d"</span>: <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>,</span><br><span class="line">        <span class="string">"w"</span>: <span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    unit = interval[<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">if</span> unit <span class="keyword">in</span> seconds_per_unit:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ms = int(interval[:<span class="number">-1</span>]) * seconds_per_unit[unit] * <span class="number">1000</span></span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_historical_klines</span><span class="params">(symbol, interval, start_str, end_str=None)</span>:</span></span><br><span class="line">    <span class="string">"""Get Historical Klines from Binance</span></span><br><span class="line"><span class="string">    See dateparse docs for valid start and end string formats http://dateparser.readthedocs.io/en/latest/</span></span><br><span class="line"><span class="string">    If using offset strings for dates add "UTC" to date string e.g. "now UTC", "11 hours ago UTC"</span></span><br><span class="line"><span class="string">    :param symbol: Name of symbol pair e.g BNBBTC</span></span><br><span class="line"><span class="string">    :type symbol: str</span></span><br><span class="line"><span class="string">    :param interval: Biannce Kline interval</span></span><br><span class="line"><span class="string">    :type interval: str</span></span><br><span class="line"><span class="string">    :param start_str: Start date string in UTC format</span></span><br><span class="line"><span class="string">    :type start_str: str</span></span><br><span class="line"><span class="string">    :param end_str: optional - end date string in UTC format</span></span><br><span class="line"><span class="string">    :type end_str: str</span></span><br><span class="line"><span class="string">    :return: list of OHLCV values</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># create the Binance client, no need for api key</span></span><br><span class="line">    client = Client(<span class="string">""</span>, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># init our list</span></span><br><span class="line">    output_data = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># setup the max limit</span></span><br><span class="line">    limit = <span class="number">500</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># convert interval to useful value in seconds</span></span><br><span class="line">    timeframe = interval_to_milliseconds(interval)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># convert our date strings to milliseconds</span></span><br><span class="line">    start_ts = date_to_milliseconds(start_str)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if an end time was passed convert it</span></span><br><span class="line">    end_ts = <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">if</span> end_str:</span><br><span class="line">        end_ts = date_to_milliseconds(end_str)</span><br><span class="line"></span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="comment"># it can be difficult to know when a symbol was listed on Binance so allow start time to be before list date</span></span><br><span class="line">    symbol_existed = <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="comment"># fetch the klines from start_ts up to max 500 entries or the end_ts if set</span></span><br><span class="line">        temp_data = client.get_klines(</span><br><span class="line">            symbol=symbol,</span><br><span class="line">            interval=interval,</span><br><span class="line">            limit=limit,</span><br><span class="line">            startTime=start_ts,</span><br><span class="line">            endTime=end_ts</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># handle the case where our start date is before the symbol pair listed on Binance</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> symbol_existed <span class="keyword">and</span> len(temp_data):</span><br><span class="line">            symbol_existed = <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> symbol_existed:</span><br><span class="line">            <span class="comment"># append this loops data to our output data</span></span><br><span class="line">            output_data += temp_data</span><br><span class="line"></span><br><span class="line">            <span class="comment"># update our start timestamp using the last value in the array and add the interval timeframe</span></span><br><span class="line">            start_ts = temp_data[len(temp_data) - <span class="number">1</span>][<span class="number">0</span>] + timeframe</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># it wasn't listed yet, increment our start date</span></span><br><span class="line">            start_ts += timeframe</span><br><span class="line"></span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">        <span class="comment"># check if we received less than the required limit and exit the loop</span></span><br><span class="line">        <span class="keyword">if</span> len(temp_data) &lt; limit:</span><br><span class="line">            <span class="comment"># exit the while loop</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># sleep after every 3rd call to be kind to the API</span></span><br><span class="line">        <span class="keyword">if</span> idx % <span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> output_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">symbol = <span class="string">"ETHBTC"</span></span><br><span class="line">start = <span class="string">"1 Dec, 2017"</span></span><br><span class="line">end = <span class="string">"1 Jan, 2018"</span></span><br><span class="line">interval = Client.KLINE_INTERVAL_30MINUTE</span><br><span class="line"></span><br><span class="line">klines = get_historical_klines(symbol, interval, start, end)</span><br><span class="line"></span><br><span class="line"><span class="comment"># open a file with filename including symbol, interval and start and end converted to milliseconds</span></span><br><span class="line"><span class="keyword">with</span> open(</span><br><span class="line">    <span class="string">"Binance_&#123;&#125;_&#123;&#125;_&#123;&#125;-&#123;&#125;.json"</span>.format(</span><br><span class="line">        symbol,</span><br><span class="line">        interval,</span><br><span class="line">        date_to_milliseconds(start),</span><br><span class="line">        date_to_milliseconds(end)</span><br><span class="line">    ),</span><br><span class="line">    <span class="string">'w'</span>  <span class="comment"># set file write mode</span></span><br><span class="line">) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(json.dumps(klines))</span><br></pre></td></tr></table></figure><p>执行例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 save_historical_data.py</span><br></pre></td></tr></table></figure><p>生成文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Binance_ETHBTC_30m_1512086400000-1514764800000.json</span><br></pre></td></tr></table></figure><p>返回结果例子：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [</span><br><span class="line">    <span class="number">1512086400000</span>,</span><br><span class="line">    <span class="string">"0.04368400"</span>,</span><br><span class="line">    <span class="string">"0.04375100"</span>,</span><br><span class="line">    <span class="string">"0.04334200"</span>,</span><br><span class="line">    <span class="string">"0.04366500"</span>,</span><br><span class="line">    <span class="string">"2081.85600000"</span>,</span><br><span class="line">    <span class="number">1512088199999</span>,</span><br><span class="line">    <span class="string">"90.79655078"</span>,</span><br><span class="line">    <span class="number">3904</span>,</span><br><span class="line">    <span class="string">"976.19100000"</span>,</span><br><span class="line">    <span class="string">"42.59074736"</span>,</span><br><span class="line">    <span class="string">"271480.34213668"</span></span><br><span class="line">  ],</span><br><span class="line">  [</span><br><span class="line">    <span class="number">1512088200000</span>,</span><br><span class="line">    <span class="string">"0.04360200"</span>,</span><br><span class="line">    <span class="string">"0.04369900"</span>,</span><br><span class="line">    <span class="string">"0.04325100"</span>,</span><br><span class="line">    <span class="string">"0.04350100"</span>,</span><br><span class="line">    <span class="string">"2420.48100000"</span>,</span><br><span class="line">    <span class="number">1512089999999</span>,</span><br><span class="line">    <span class="string">"105.27683806"</span>,</span><br><span class="line">    <span class="number">2775</span>,</span><br><span class="line">    <span class="string">"1133.24800000"</span>,</span><br><span class="line">    <span class="string">"49.31486895"</span>,</span><br><span class="line">    <span class="string">"271300.32546398"</span></span><br><span class="line">  ],</span><br><span class="line">  [</span><br><span class="line">    <span class="number">1512090000000</span>,</span><br><span class="line">    <span class="string">"0.04350100"</span>,</span><br><span class="line">    <span class="string">"0.04379400"</span>,</span><br><span class="line">    <span class="string">"0.04304900"</span>,</span><br><span class="line">    <span class="string">"0.04370500"</span>,</span><br><span class="line">    <span class="string">"2192.51500000"</span>,</span><br><span class="line">    <span class="number">1512091799999</span>,</span><br><span class="line">    <span class="string">"95.48824264"</span>,</span><br><span class="line">    <span class="number">2359</span>,</span><br><span class="line">    <span class="string">"1029.30200000"</span>,</span><br><span class="line">    <span class="string">"44.86783356"</span>,</span><br><span class="line">    <span class="string">"271143.81327337"</span></span><br><span class="line">  ],</span><br><span class="line">  [</span><br><span class="line">    <span class="number">1512091800000</span>,</span><br><span class="line">    <span class="string">"0.04374900"</span>,</span><br><span class="line">    <span class="string">"0.04392000"</span>,</span><br><span class="line">    <span class="string">"0.04361300"</span>,</span><br><span class="line">    <span class="string">"0.04378100"</span>,</span><br><span class="line">    <span class="string">"1482.24800000"</span>,</span><br><span class="line">    <span class="number">1512093599999</span>,</span><br><span class="line">    <span class="string">"64.86877196"</span>,</span><br><span class="line">    <span class="number">2112</span>,</span><br><span class="line">    <span class="string">"704.81600000"</span>,</span><br><span class="line">    <span class="string">"30.85380066"</span>,</span><br><span class="line">    <span class="string">"271394.84389969"</span></span><br><span class="line">  ],</span><br><span class="line">  [</span><br><span class="line">    <span class="number">1512093600000</span>,</span><br><span class="line">    <span class="string">"0.04375800"</span>,</span><br><span class="line">    <span class="string">"0.04424900"</span>,</span><br><span class="line">    <span class="string">"0.04364800"</span>,</span><br><span class="line">    <span class="string">"0.04403800"</span>,</span><br><span class="line">    <span class="string">"2073.49800000"</span>,</span><br><span class="line">    <span class="number">1512095399999</span>,</span><br><span class="line">    <span class="string">"90.95341447"</span>,</span><br><span class="line">    <span class="number">2763</span>,</span><br><span class="line">    <span class="string">"996.44700000"</span>,</span><br><span class="line">    <span class="string">"43.72006243"</span>,</span><br><span class="line">    <span class="string">"271126.63134592"</span></span><br><span class="line">  ],</span><br><span class="line">  [</span><br><span class="line">    <span class="number">1512095400000</span>,</span><br><span class="line">    <span class="string">"0.04400500"</span>,</span><br><span class="line">    <span class="string">"0.04421400"</span>,</span><br><span class="line">    <span class="string">"0.04380000"</span>,</span><br><span class="line">    <span class="string">"0.04389900"</span>,</span><br><span class="line">    <span class="string">"1675.47800000"</span>,</span><br><span class="line">    <span class="number">1512097199999</span>,</span><br><span class="line">    <span class="string">"73.62046216"</span>,</span><br><span class="line">    <span class="number">1817</span>,</span><br><span class="line">    <span class="string">"808.25500000"</span>,</span><br><span class="line">    <span class="string">"35.52008528"</span>,</span><br><span class="line">    <span class="string">"271368.11447690"</span></span><br><span class="line">  ],</span><br><span class="line">  [</span><br><span class="line">    <span class="number">1512097200000</span>,</span><br><span class="line">    <span class="string">"0.04390400"</span>,</span><br><span class="line">    <span class="string">"0.04413600"</span>,</span><br><span class="line">    <span class="string">"0.04364200"</span>,</span><br><span class="line">    <span class="string">"0.04400500"</span>,</span><br><span class="line">    <span class="string">"2138.10400000"</span>,</span><br><span class="line">    <span class="number">1512098999999</span>,</span><br><span class="line">    <span class="string">"93.95901243"</span>,</span><br><span class="line">    <span class="number">2260</span>,</span><br><span class="line">    <span class="string">"1157.93700000"</span>,</span><br><span class="line">    <span class="string">"50.88996640"</span>,</span><br><span class="line">    <span class="string">"271143.40315253"</span></span><br><span class="line">  ]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>大家可以试试，在后续回测中可以用到。</p><p>如果大家遇到报错，请升级下cryptography的包，命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -U cryptography</span><br></pre></td></tr></table></figure><p>后续我也会多些一些原创的区块链技术方面的文章。</p></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>坚持原创技术分享，您的支持将鼓励xinqiyang继续创作！</div><button id="rewardButton" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'><span>Donate</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/images/wechatpay.jpg" alt="xinqiyang WeChat Pay"><p>WeChat Pay</p></div><div id="alipay" style="display:inline-block"><img id="alipay_qr" src="/images/alipay.jpg" alt="xinqiyang Alipay"><p>Alipay</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author:</strong>xinqiyang</li><li class="post-copyright-link"><strong>Post link:</strong> <a href="http://yangxinqi.com/2018/02/06/区块链数据分析之保存币安历史数据/" title="区块链数据分析之保存币安历史数据">http://yangxinqi.com/2018/02/06/区块链数据分析之保存币安历史数据/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally.</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/block-chain-binance-historical-data/" rel="tag"># block chain, binance, historical data</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2018/02/06/将blog迁移到hexo了/" rel="next" title="将blog迁移到hexo了"><i class="fa fa-chevron-left"></i> 将blog迁移到hexo了</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"></div></div></footer></div></article><div class="post-spread"><div class="bdsharebuttonbox"><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a> <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a> <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a> <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a> <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a> <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a> <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a> <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a> <a href="#" class="bds_more" data-cmd="more"></a> <a class="bds_count" data-cmd="count"></a></div><script>window._bd_share_config={common:{bdText:"",bdMini:"2",bdMiniList:!1,bdPic:""},share:{bdSize:"16",bdStyle:"0"},image:{viewList:["tsina","douban","sqq","qzone","weixin","twi","fbook"],viewText:"分享到：",viewSize:"16"}}</script><script>with(document)0[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="//bdimg.share.baidu.com/static/api/js/share.js?cdnversion="+~(-new Date/36e5)]</script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">Overview</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/avatar.jpg" alt="xinqiyang"><p class="site-author-name" itemprop="name">xinqiyang</p><p class="site-description motion-element" itemprop="description">xinqiyang's notes</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">9</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><span class="site-state-item-count">4</span> <span class="site-state-item-name">categories</span></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">2</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/xinqiyang" target="_blank" title="GitHub"><i class="fa fa-fw fa-globe"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://twitter.com/xinqiyang" target="_blank" title="Twitter"><i class="fa fa-fw fa-globe"></i>Twitter</a> </span><span class="links-of-author-item"><a href="https://weibo.com/xinqiyang" target="_blank" title="Weibo"><i class="fa fa-fw fa-globe"></i>Weibo</a> </span><span class="links-of-author-item"><a href="https://www.douban.com/people/scotoma/" target="_blank" title="DouBan"><i class="fa fa-fw fa-globe"></i>DouBan</a> </span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/xiaoxinsqqqq/activities" target="_blank" title="ZhiHu"><i class="fa fa-fw fa-globe"></i>ZhiHu</a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#正文"><span class="nav-number">1.</span> <span class="nav-text">正文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#首先需要处理时间格式"><span class="nav-number">2.</span> <span class="nav-text">首先需要处理时间格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取币安的K线数据"><span class="nav-number">3.</span> <span class="nav-text">获取币安的K线数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#币安时间间隔intervals"><span class="nav-number">4.</span> <span class="nav-text">币安时间间隔intervals</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取K线数据"><span class="nav-number">5.</span> <span class="nav-text">获取K线数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#保存到文件"><span class="nav-number">6.</span> <span class="nav-text">保存到文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#打赏功能"><span class="nav-number">7.</span> <span class="nav-text">打赏功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#接下来"><span class="nav-number">8.</span> <span class="nav-text">接下来</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#结语"><span class="nav-number">9.</span> <span class="nav-text">结语</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">xinqiyang</span></div><div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div><span class="post-meta-divider">|</span><div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.0.3</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/js/src/utils.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/motion.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/post-details.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.3"></script></body></html><!-- rebuild by neat -->